@if (asset$ | async; as asset) {
  <div class="header">
    <span class="header__title" data-testid="assetTitle" [title]="asset.title">{{ asset.title }}</span>
    <button
      (click)="clearSelectedAsset()"
      asset-sg-icon-button
      class="close-button"
      [attr.alt]="'search.closeAssetDetails' | translate"
    >
      <svg-icon key="close"></svg-icon>
    </button>
  </div>
  <div class="asset-detail-scroll-container">
    <div class="asset-detail">
      <div class="asset-detail__general">
        <sgc-card [header]="'search.status' | translate" collapsed>
          <asset-sg-status-chip [status]="asset.workflowStatus"></asset-sg-status-chip>
        </sgc-card>
        <sgc-card [header]="'edit.tabs.general.access.name' | translate" collapsed>
          <!-- todo assets-631: add edit.visibility.lockedUntil with formatted date -->
          <asset-sg-chip type="light"
            >{{ (asset.isPublic ? "edit.visibility.public" : "edit.visibility.locked") | translate }}
          </asset-sg-chip>
        </sgc-card>
      </div>

      <hr class="divider" />

      <sgc-card [header]="'search.subject' | translate" data-testid="assetSubject">
        <div class="chip-group">
          @for (topicCode of asset.topicCodes; track topicCode) {
            <asset-sg-chip type="transparent">{{ topicCode | reference: "assetTopics" }}</asset-sg-chip>
          }
        </div>
      </sgc-card>

      <sgc-card [header]="'search.kind' | translate" data-testid="assetKindCode">
        <asset-sg-chip type="transparent">{{ asset.kindCode | reference: "assetKinds" }}</asset-sg-chip>
      </sgc-card>

      @if (asset.languageCodes.length > 0) {
        <sgc-card [header]="'search.language' | translate" data-testid="assetLanguage">
          <div class="chip-group">
            @for (languageCode of asset.languageCodes; track languageCode) {
              <asset-sg-chip type="transparent">
                {{ languageCode | reference: "languages" }}
              </asset-sg-chip>
            }
          </div>
        </sgc-card>
      }

      <sgc-card [header]="'search.format' | translate" data-testid="assetFormat">
        <asset-sg-chip type="transparent">{{ asset.formatCode | reference: "assetFormats" }}</asset-sg-chip>
      </sgc-card>

      <hr class="divider" />

      @if (asset.originalTitle) {
        <sgc-card [header]="'search.originalTitle' | translate" data-testid="assetOriginalTitle">
          {{ asset.originalTitle }}
        </sgc-card>
      }

      <sgc-card [header]="'search.date' | translate" data-testid="assetDates">
        <div class="col-2">
          <dl>
            <dt translate>search.createdDate</dt>
            <dd>{{ asset.createdAt | assetSgDate }}</dd>
          </dl>
          <dl>
            <dt translate>search.receiptDate</dt>
            <dd>{{ asset.receivedAt | assetSgDate }}</dd>
          </dl>
        </div>
      </sgc-card>

      <sgc-card [header]="'search.nationalInterest' | translate" data-testid="assetNatInt">
        <span translate>{{ asset.isOfNationalInterest ? "yes" : "no" }}</span>
        <hr class="divider" />
        <div class="chip-group chip-group--vertical" data-testid="assetNatIntCodes">
          @for (nationalInterestTypeCode of asset.nationalInterestTypeCodes; track nationalInterestTypeCode) {
            <asset-sg-chip type="transparent">
              {{ nationalInterestTypeCode | reference: "nationalInterestTypes" }}
            </asset-sg-chip>
          }
        </div>
      </sgc-card>

      @if (asset.contacts.length > 0) {
        <sgc-card [header]="'search.contacts' | translate" data-testid="assetContacts">
          @for (contactGroup of contacts$ | async | keyvalue; track contactGroup.key) {
            <dl>
              <dt>{{ "contactRoles." + contactGroup.key | translate }}</dt>
              <dd class="chip-group">
                @for (contact of contactGroup.value; track contact.id) {
                  <!-- todo: the tooltip should be replaced with a proper tooltip component; however, that's not in scope of this task -->
                  <asset-sg-chip
                    [title]="
                      [
                        contact.name,
                        [contact.street, contact.houseNumber].join(' '),
                        [contact.plz, contact.locality].join(' '),
                      ].join('&#10;')
                    "
                    type="transparent"
                    >{{ contact.name }}</asset-sg-chip
                  >
                }
              </dd>
            </dl>

            @if (!$last) {
              <hr class="divider" />
            }
          }
        </sgc-card>
      }

      @if (asset.identifiers.length > 0) {
        <sgc-card [header]="('search.alternativeId' | translate) + 's'" data-testid="assetAlternativeId">
          @for (identifier of asset.identifiers; track identifier.id) {
            <div class="col-2">
              <dl>
                <dt>ID</dt>
                <dd>{{ identifier.value }}</dd>
              </dl>
              <dl>
                <dt translate>search.alternativeIdDescription</dt>
                <dd>{{ identifier.description }}</dd>
              </dl>
            </div>

            @if (!$last) {
              <hr class="divider" />
            }
          }
        </sgc-card>
      }

      @if (normalFiles$ | async; as normalFiles) {
        @if (normalFiles.length > 0) {
          <sgc-card [header]="'search.documents' | translate" data-testid="assetNormalFiles">
            <ul asset-sg-asset-viewer-files [assetId]="asset.id" [files]="normalFiles"></ul>
          </sgc-card>
        }
      }

      @if (legalFiles$ | async; as legalFiles) {
        @if (legalFiles.length > 0) {
          <sgc-card [header]="'search.legalDocuments' | translate" data-testid="assetLegalFiles">
            <ul asset-sg-asset-viewer-files [assetId]="asset.id" [files]="legalFiles" isLegal></ul>
          </sgc-card>
        }
      }

      @if (linkedAssets$ | async; as linkedAssets) {
        @if (linkedAssets.length > 0) {
          <sgc-card [header]="'search.references' | translate" data-testid="assetReferences">
            <ul>
              @for (linkedAsset of linkedAssets; track linkedAsset.id) {
                <li>
                  <a
                    asset-sg-reset
                    class="reference-link"
                    (click)="selectAsset(linkedAsset.id)"
                    queryParamsHandling="merge"
                  >
                    <sgc-icon [name]="'reference'" [size]="'large'"></sgc-icon>
                    <span>{{ linkedAsset.title }}</span>
                  </a>
                </li>

                @if (!$last) {
                  <hr class="divider" />
                }
              }
            </ul>
          </sgc-card>
        }
      }
    </div>
  </div>

  @if (canUpdate$ | async) {
    <div class="footer" data-testid="assetFooter">
      <sgc-button
        data-testid="edit-asset-button"
        *rxLet="language$; let language"
        (click)="navigateToEdit(language, asset.id)"
      >
        <sgc-icon name="edit"></sgc-icon>
        <span translate>search.editAsset</span>
      </sgc-button>
    </div>
  }
} @else {
  <div class="loading-spinner">
    <mat-progress-spinner mode="indeterminate" />
  </div>
}
