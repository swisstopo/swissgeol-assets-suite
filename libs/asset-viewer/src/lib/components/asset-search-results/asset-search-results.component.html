<ng-container *rxLet="isResultsOpen$; let isResultsOpen">
  <div class="header">
    <div>
      <asset-sg-animate-number [nextValue]="(total$ | async) ?? 0" />
      {{ "search.searchResults" | translate }}
    </div>
    <button asset-sg-tertiary (click)="toggleResultsOpen()">
      <span> {{ (isResultsOpen ? "search.hideTable" : "search.showTable") | translate }} </span>
      <svg-icon [key]="isResultsOpen ? 'arrow-down' : 'arrow-up'"></svg-icon>
    </button>
  </div>
  @if (isResultsOpen) {
    <div class="search-results">
      <div class="table-container" (scroll)="onScroll($event)" #scrollContainer>
        <table mat-table [dataSource]="resultsToDisplay" class="mat-elevation-z8 table">
          <ng-container matColumnDef="favourites">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let asset">
              <button asset-sg-favorite [assetId]="asset.id" (click)="$event.stopPropagation()"></button>
            </td>
          </ng-container>
          <ng-container matColumnDef="titlePublic">
            <th mat-header-cell *matHeaderCellDef translate>{{ "edit.tabs.references.assetTitlePublic" }}</th>
            <td mat-cell *matCellDef="let asset">{{ asset.title }}</td>
          </ng-container>
          <ng-container matColumnDef="assetFormat">
            <th mat-header-cell *matHeaderCellDef translate>{{ "search.kind" }}</th>
            <td mat-cell *matCellDef="let asset">
              {{ asset.kindCode | reference: "assetKinds" }} &ndash; {{ asset.formatCode | reference: "assetFormats" }}
            </td>
          </ng-container>
          <ng-container matColumnDef="manCatLabel">
            <th mat-header-cell *matHeaderCellDef translate>{{ "search.topic" }}</th>
            <td mat-cell *matCellDef="let asset">
              @for (topicCode of asset.topicCodes; track topicCode) {
                <div>
                  {{ topicCode | reference: "assetTopics" }}
                </div>
              }
            </td>
          </ng-container>
          <ng-container matColumnDef="authors">
            <th mat-header-cell *matHeaderCellDef translate>{{ "contactRoles.author" }}</th>
            <td mat-cell *matCellDef="let asset">
              @for (contact of asset.contacts; track trackContact(contact)) {
                @if (contact.role === AssetContactRole.Author) {
                  <div>{{ contact.id | reference: "contacts" }}</div>
                }
              }
            </td>
          </ng-container>
          <ng-container matColumnDef="initiators">
            <th mat-header-cell *matHeaderCellDef translate>{{ "contactRoles.initiator" }}</th>
            <td mat-cell *matCellDef="let asset">
              @for (contact of asset.contacts; track trackContact(contact)) {
                @if (contact.role === AssetContactRole.Initiator) {
                  <div>{{ contact.id | reference: "contacts" }}</div>
                }
              }
            </td>
          </ng-container>
          <ng-container matColumnDef="suppliers">
            <th mat-header-cell *matHeaderCellDef translate>{{ "contactRoles.supplier" }}</th>
            <td mat-cell *matCellDef="let asset">
              @for (contact of asset.contacts; track trackContact(contact)) {
                @if (contact.role === AssetContactRole.Supplier) {
                  <div>{{ contact.id | reference: "contacts" }}</div>
                }
              }
            </td>
          </ng-container>
          <ng-container matColumnDef="createDate">
            <th mat-header-cell *matHeaderCellDef translate>{{ "search.createdDate" }}</th>
            <td mat-cell *matCellDef="let asset">
              {{ asset.createdAt | assetSgDate }}
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="COLUMNS; sticky: true" class="table__header"></tr>
          <tr
            clickable
            mat-row
            *matRowDef="let row; columns: COLUMNS"
            (click)="searchForAsset(row.id)"
            (mouseover)="assetMouseOver.emit(row.id)"
            (mouseleave)="assetMouseOver.emit(null)"
            [ngClass]="{ selected: row.id === (currentAsset$ | async)?.id }"
          ></tr>
        </table>
      </div>
    </div>
  }
</ng-container>
